---
import { Image } from 'astro:assets';
import logoImg from '@/assets/common/logo.jpg';

const navItems = [
	{
		href: '/#service',
		label: 'Service',
		icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>`,
	},
	{
		href: '/#flow',
		label: 'Flow',
		icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="5" r="3"/><line x1="12" y1="8" x2="12" y2="14"/><circle cx="12" cy="19" r="3"/><line x1="12" y1="16" x2="12" y2="14"/></svg>`,
	},
	{
		href: '/#works',
		label: 'Works',
		icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>`,
	},
	{
		href: '/contact',
		label: 'Contact',
		icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>`,
	},
	{
		href: '/about',
		label: 'About',
		icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
	},
];
---

<!-- Desktop: Sidebar -->
<nav class="fixed top-0 left-0 w-sidebar h-dvh bg-primary hidden lg:flex flex-col items-center py-6 z-menu" aria-label="メインナビゲーション">
	<a href="/" class="no-underline mb-8">
		<Image src={logoImg} alt="うぇぶまか ホームへ戻る" width={320} format="webp" quality={80} class="w-40 h-auto rounded" />
	</a>

	<ul class="flex flex-col gap-2 list-none m-0 p-0">
		{navItems.map((item) => (
			<li class="flex">
				<a href={item.href} class="flex flex-row items-center gap-3 px-4 py-3 text-white/70 no-underline rounded-lg transition-colors duration-200 w-full hover:text-white hover:bg-white/10">
					<span class="flex items-center justify-center [&_svg]:w-5 [&_svg]:h-5" set:html={item.icon} />
					<span class="text-sm font-bold tracking-wide">{item.label}</span>
				</a>
			</li>
		))}
	</ul>
</nav>

<!-- Mobile: Header Bar + Slide-in Sidebar -->
<div data-mobile-nav class="group block lg:hidden">
	<!-- Mobile Header Bar -->
	<header class="fixed top-0 left-0 right-0 z-menu bg-primary flex items-center justify-between ps-2 pe-4 py-2">
		<a href="/" class="no-underline">
			<Image src={logoImg} alt="うぇぶまか ホームへ戻る" width={320} format="webp" quality={80} class="w-30 h-auto rounded" />
		</a>
		<button data-hamburger class="z-menu border-0 cursor-pointer w-12 h-12 bg-bg-main rounded-8px flex flex-col items-center justify-center gap-1-25 shadow-md" aria-label="メニューを開く" aria-expanded="false">
			<span class="block w-5 h-0.5 bg-primary transition-all duration-300 origin-center group-[.is-open]:rotate-45 group-[.is-open]:translate-x-hamburger group-[.is-open]:translate-y-hamburger"></span>
			<span class="block w-5 h-0.5 bg-primary transition-all duration-300 origin-center group-[.is-open]:opacity-0"></span>
			<span class="block w-5 h-0.5 bg-primary transition-all duration-300 origin-center group-[.is-open]:-rotate-45 group-[.is-open]:translate-x-hamburger group-[.is-open]:-translate-y-hamburger"></span>
		</button>
	</header>
	<div data-overlay class="fixed inset-0 bg-black/50 opacity-0 invisible transition-all duration-300 z-menu-overlay group-[.is-open]:opacity-100 group-[.is-open]:visible"></div>
	<nav data-mobile-sidebar class="fixed top-0 left-0 w-sidebar h-dvh bg-primary flex flex-col items-center py-6 z-menu -translate-x-full transition-transform duration-300 ease-in-out group-[.is-open]:translate-x-0" aria-label="モバイルナビゲーション">
		<a href="/" class="no-underline mb-8">
			<Image src={logoImg} alt="うぇぶまか ホームへ戻る" width={320} format="webp" quality={80} class="w-40 h-auto rounded" />
		</a>
		<ul class="flex flex-col gap-2 list-none m-0 p-0">
			{navItems.map((item) => (
				<li class="flex">
					<a href={item.href} data-menu-link class="flex flex-row items-center gap-3 px-4 py-3 text-white/70 no-underline rounded-lg transition-colors duration-200 w-full hover:text-white hover:bg-white/10">
						<span class="flex items-center justify-center [&_svg]:w-5 [&_svg]:h-5" set:html={item.icon} />
						<span class="text-sm font-bold tracking-wide">{item.label}</span>
					</a>
				</li>
			))}
		</ul>
	</nav>
</div>

<script>
  const mobileNav = document.querySelector('[data-mobile-nav]');
  const hamburger = document.querySelector('[data-hamburger]') as HTMLButtonElement | null;
  const overlay = document.querySelector('[data-overlay]');
  const menuLinks = document.querySelectorAll('[data-menu-link]');

  function toggleMenu() {
    const isOpen = mobileNav?.classList.toggle('is-open');
    hamburger?.setAttribute('aria-expanded', String(isOpen));
    document.body.style.overflow = isOpen ? 'hidden' : '';
  }

  function closeMenu() {
    mobileNav?.classList.remove('is-open');
    hamburger?.setAttribute('aria-expanded', 'false');
    document.body.style.overflow = '';
  }

  hamburger?.addEventListener('click', toggleMenu);
  overlay?.addEventListener('click', closeMenu);
  menuLinks.forEach(link => link.addEventListener('click', closeMenu));

  // Escapeキーでメニューを閉じる
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && mobileNav?.classList.contains('is-open')) {
      closeMenu();
      hamburger?.focus();
    }
  });
</script>
